var nodemailer = require('nodemailer');

var SendMail = function(){};
SendMail.prototype.SendEmail = function (job, emailSender, callbackDone,callbackFailed)
{
    // create reusable transporter object using the default SMTP transport
    var transporter = nodemailer.createTransport({
            //service: 'Gmail',
            // host: "mail.instaupdev.com", // hostname
            // secureConnection: false, // use SSL
            // port: 25, // port for secure SMTP
            // auth: {
                // user: 'kiosagro@instaupdev.com', // Your email id
                // pass: 'password123' // Your password
            // }
            service: 'Gmail',
            secureConnection: true, // use SSL
            port: 465, // port for secure SMTP
            auth:emailSender, 
            // {
            //     user: 'albaipro@gmail.com', // Your email id
            //     pass: 'programeralbai' // Your password
            // }
        });

    // setup e-mail data with unicode symbols
    var mailOptions = {
        from: 'no-reply@kiosagro.com', // sender address
        to: job.data.email, // list of receivers
        subject: 'Salam dari kiosagro.com', // Subject line
        //text: 'Hello world üê¥', // plaintext body
        html: '<link href="http://kiosagro.com/oc-content/themes/osclasswizards/css/email_css.css" rel="stylesheet" type="text/css"><table width="100%" bgcolor="#f8f8f8" cellpadding="0" cellspacing="0" border="0" id="backgroundTable" st-sortable="preheader" > <tbody> <tr> <td> <table width="600" cellpadding="0" cellspacing="0" border="0" align="center" class="devicewidth"> <tbody> <tr> <td width="100%"> <table width="600" cellpadding="0" cellspacing="0" border="0" align="center" class="devicewidth"> <tbody> <tr> <td width="100%" height="20"></td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody></table> <table width="100%" bgcolor="#f8f8f8" cellpadding="0" cellspacing="0" border="0" id="backgroundTable" st-sortable="header"> <tbody> <tr> <td> <table width="600" cellpadding="0" cellspacing="0" border="0" align="center" class="devicewidth"> <tbody> <tr> <td width="100%"><div style="text-align:center; border-bottom:1px solid; padding: 5px"><a href="http://www.kiosagro.com/?utm_source=notification&utm_medium=email&utm_term=email&utm_campaign=logo"><img src="http://kiosagro.com/oc-content/themes/osclasswizards/images/kiosagro_logo_email.png" height="60px"></a></div></td></tr></tbody> </table> </td></tr></tbody></table><table width="100%" bgcolor="#f8f8f8" cellpadding="0" cellspacing="0" border="0" id="backgroundTable" st-sortable="seperator"> <tbody> <tr> <td> <table width="600" align="center" cellspacing="0" cellpadding="0" border="0" class="devicewidth"> <tbody> <tr> <td align="center" height="30" style="font-size:1px; line-height:1px;">&nbsp;</td></tr></tbody> </table> </td></tr></tbody></table> <table width="100%" bgcolor="#f8f8f8" cellpadding="0" cellspacing="0" border="0" id="backgroundTable" st-sortable="banner"> <tbody> <tr> <td> <table width="600" cellpadding="0" cellspacing="0" border="0" align="center" class="devicewidth"> <tbody> <tr> <td width="100%"> <table width="600" align="center" cellspacing="0" cellpadding="0" border="0" class="devicewidth"> <tbody> <tr> <td align="center" st-image="banner-image"> <div class="imgpop"> <a target="_blank" href="http://www.kiosagro.com/?utm_source=notification&utm_medium=email&utm_term=email&utm_campaign=blast"><img width="600" border="0" height="250" alt="" border="0" style="display:block; border:none; outline:none; text-decoration:none;" src="http://kiosagro.com/oc-content/themes/osclasswizards/images/banner_email.jpg" class="banner"></a> </div></td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody></table> <table width="100%" bgcolor="#f8f8f8" cellpadding="0" cellspacing="0" border="0" id="backgroundTable" st-sortable="seperator"> <tbody> <tr> <td> <table width="600" align="center" cellspacing="0" cellpadding="0" border="0" class="devicewidth"> <tbody> <tr> <td align="center" height="30" style="font-size:1px; line-height:1px;">&nbsp;</td></tr></tbody> </table> </td></tr></tbody></table> <table width="100%" bgcolor="#f8f8f8" cellpadding="0" cellspacing="0" border="0" id="backgroundTable" st-sortable="full-text"> <tbody> <tr> <td> <table width="600" cellpadding="0" cellspacing="0" border="0" align="center" class="devicewidth"> <tbody> <tr> <td width="100%"> <table bgcolor="#ffffff" width="600" cellpadding="0" cellspacing="0" border="0" align="center" class="devicewidth" style="border :2px solid #eaeff2"> <tbody> <tr> <td height="20" style="font-size:1px; line-height:1px; mso-line-height-rule: exactly;">&nbsp;</td></tr><tr> <td> <table width="560" align="center" cellpadding="0" cellspacing="0" border="0" class="devicewidthinner"> <tbody> <tr> <td style="font-family: Helvetica, arial, sans-serif; font-size: 18px; color: #282828; text-align:center; line-height: 24px;"> Hallo '+ job.data.name +', !!! </td></tr><tr> <td width="100%" height="15" style="font-size:1px; line-height:1px; mso-line-height-rule: exactly;">&nbsp;</td></tr><tr> <td style="font-family: Helvetica, arial, sans-serif; font-size: 14px; color: #4d4d4d; text-align:center; line-height: 24px;"> Perkenalkan <a href="http://www.kiosagro.com/?utm_source=newsletter&utm_medium=email&utm_term=email&utm_campaign=websitename" target="_blank">Kiosagro.com</a>, adalah sebuah Web Marketplace Agribisnis yang menyediakan tempat untuk para petani dan pengusaha di bidang Agribisnis untuk mempromosikan usaha, mencari kebutuhan dan menawarkan kerja sama kepada pengusaha agribisnis lainya. dengan harapan agar sektor agribisnis di Indonesia semakin maju, mensejahterakan para petani serta pengusaha agribisni dan dapat mengurangi Import berbagai macam kebutuhan pokok dari luar negri. </td></tr><tr> <td width="100%" height="15" style="font-size:1px; line-height:1px; mso-line-height-rule: exactly;">&nbsp;</td></tr></tbody> </table> </td></tr><tr> <td height="20" style="font-size:1px; line-height:1px; mso-line-height-rule: exactly;">&nbsp;</td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody></table><table width="100%" bgcolor="#f8f8f8" cellpadding="0" cellspacing="0" border="0" id="backgroundTable" st-sortable="seperator"> <tbody> <tr> <td> <table width="600" align="center" cellspacing="0" cellpadding="0" border="0" class="devicewidth"> <tbody> <tr> <td align="center" height="30" style="font-size:1px; line-height:1px;">&nbsp;</td></tr></tbody> </table> </td></tr></tbody></table> <table width="100%" bgcolor="#f8f8f8" cellpadding="0" cellspacing="0" border="0" id="backgroundTable" st-sortable="banner"> <tbody> <tr> <td> <table width="600" cellpadding="0" cellspacing="0" border="0" align="center" class="devicewidth"> <tbody> <tr> <td width="100%"> <table width="600" align="center" cellspacing="0" cellpadding="0" border="0" class="devicewidth"> <tbody> <tr> <td align="center" st-image="banner-image"> <div class="imgpop"> <a target="_blank" href="http://www.kiosagro.com/?utm_source=notification&utm_medium=email&utm_term=email&utm_campaign=blast"><img width="600" border="0" height="133" alt="" border="0" style="display:block; border:none; outline:none; text-decoration:none;" src="http://kiosagro.com/oc-content/themes/osclasswizards/images/banner-small.jpg" class="banner"></a> </div></td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody></table> <table width="100%" bgcolor="#f8f8f8" cellpadding="0" cellspacing="0" border="0" id="backgroundTable" st-sortable="seperator"> <tbody> <tr> <td> <table width="600" align="center" cellspacing="0" cellpadding="0" border="0" class="devicewidth"> <tbody> <tr> <td align="center" height="30" style="font-size:1px; line-height:1px;">&nbsp;</td></tr></tbody> </table> </td></tr></tbody></table> <table width="100%" bgcolor="#f8f8f8" cellpadding="0" cellspacing="0" border="0" id="backgroundTable" st-sortable="right-image"> <tbody> <tr> <td> <table width="600" cellpadding="0" cellspacing="0" border="0" align="center" class="devicewidth"> <tbody> <tr> <td width="100%"> <table width="600" cellpadding="0" cellspacing="0" border="0" align="center" class="devicewidth" bgcolor="#ffffff" style="border :2px solid #eaeff2"> <tbody> <tr> <td> <table width="280" align="right" border="0" cellpadding="0" cellspacing="0" class="devicewidth"> <tbody> <tr> <td width="280" height="140" align="center" class="devicewidth"> <img src="http://kiosagro.com/oc-content/themes/osclasswizards/images/promosi-beli.jpg" alt="" border="0" width="280" height="140" style="display:block; border:none; outline:none; text-decoration:none;" class="col2img"> </td></tr></tbody> </table> <table align="left" border="0" cellpadding="0" cellspacing="0" class="mobilespacing"> <tbody> <tr> <td width="100%" height="15" style="font-size:1px; line-height:1px; mso-line-height-rule: exactly;">&nbsp;</td></tr></tbody> </table> <table width="280" align="left" border="0" cellpadding="0" cellspacing="0" class="devicewidth"> <tbody> <tr> <td> <table width="280" align="center" border="0" cellpadding="0" cellspacing="0" class="devicewidth"> <tbody> <tr> <td style="font-family: Helvetica, arial, sans-serif; font-size: 18px; color: #282828; text-align:left; line-height: 24px;"> Jual Hasil anda disini </td></tr><tr> <td width="100%" height="15" style="font-size:1px; line-height:1px; mso-line-height-rule: exactly;">&nbsp;</td></tr><tr> <td style="font-family: Helvetica, arial, sans-serif; font-size: 14px; color: #4d4d4d; text-align:left; line-height: 24px;"> Temukan Berbagai macam hasil Agribisnis dari seluruh wilayah Indonesia disini. </td></tr><tr> <td width="100%" height="15" style="font-size:1px; line-height:1px; mso-line-height-rule: exactly;">&nbsp;</td></tr><tr> <td> <table width="120" height="32" bgcolor="#1dff22" align="left" valign="middle" border="0" cellpadding="0" cellspacing="0" style="border-radius:3px;" st-button="learnmore"> <tbody> <tr> <td height="9" align="center" style="font-size:1px; line-height:1px;">&nbsp;</td></tr><tr> <td height="14" align="center" valign="middle" style="font-family: Helvetica, Arial, sans-serif; font-size: 13px; font-weight:bold;color: #ffffff; text-align:center; line-height: 14px; ; -webkit-text-size-adjust:none;" st-title="fulltext-btn"> <a style="text-decoration: none;color: #282828; text-align:center;" href="http://www.kiosagro.com/jual/?utm_source=notification&utm_medium=email&utm_term=email&utm_campaign=blast">Klik Disini</a> </td></tr><tr> <td height="9" align="center" style="font-size:1px; line-height:1px;">&nbsp;</td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody></table><table width="100%" bgcolor="#f8f8f8" cellpadding="0" cellspacing="0" border="0" id="backgroundTable" st-sortable="seperator"> <tbody> <tr> <td> <table width="600" align="center" cellspacing="0" cellpadding="0" border="0" class="devicewidth"> <tbody> <tr> <td align="center" height="30" style="font-size:1px; line-height:1px;">&nbsp;</td></tr></tbody> </table> </td></tr></tbody></table> <table width="100%" bgcolor="#f8f8f8" cellpadding="0" cellspacing="0" border="0" id="backgroundTable" st-sortable="right-image"> <tbody> <tr> <td> <table width="600" cellpadding="0" cellspacing="0" border="0" align="center" class="devicewidth"> <tbody> <tr> <td width="100%"> <table width="600" cellpadding="0" cellspacing="0" border="0" align="center" class="devicewidth" bgcolor="#ffffff" style="border :2px solid #eaeff2"> <tbody> <tr> <td> <table width="280" align="right" border="0" cellpadding="0" cellspacing="0" class="devicewidth"> <tbody> <tr> <td width="280" height="140" align="center" class="devicewidth"> <img src="http://kiosagro.com/oc-content/themes/osclasswizards/images/promosi-beli.jpg" alt="" border="0" width="280" height="140" style="display:block; border:none; outline:none; text-decoration:none;" class="col2img"> </td></tr></tbody> </table> <table align="left" border="0" cellpadding="0" cellspacing="0" class="mobilespacing"> <tbody> <tr> <td width="100%" height="15" style="font-size:1px; line-height:1px; mso-line-height-rule: exactly;">&nbsp;</td></tr></tbody> </table> <table width="280" align="left" border="0" cellpadding="0" cellspacing="0" class="devicewidth"> <tbody> <tr> <td> <table width="280" align="center" border="0" cellpadding="0" cellspacing="0" class="devicewidth"> <tbody> <tr> <td style="font-family: Helvetica, arial, sans-serif; font-size: 18px; color: #282828; text-align:left; line-height: 24px;"> Post Kebutuhan anda disini </td></tr><tr> <td width="100%" height="15" style="font-size:1px; line-height:1px; mso-line-height-rule: exactly;">&nbsp;</td></tr><tr> <td style="font-family: Helvetica, arial, sans-serif; font-size: 14px; color: #4d4d4d; text-align:left; line-height: 24px;"> Post kebutuhan agribisnis anda disini atau temukan konsumen yang sedang membutuhkan hasil agribisnis anda. </td></tr><tr> <td width="100%" height="15" style="font-size:1px; line-height:1px; mso-line-height-rule: exactly;">&nbsp;</td></tr><tr> <td> <table width="120" height="32" bgcolor="#1dff22" align="left" valign="middle" border="0" cellpadding="0" cellspacing="0" style="border-radius:3px;" st-button="learnmore"> <tbody> <tr> <td height="9" align="center" style="font-size:1px; line-height:1px;">&nbsp;</td></tr><tr> <td height="14" align="center" valign="middle" style="font-family: Helvetica, Arial, sans-serif; font-size: 13px; font-weight:bold;color: #ffffff; text-align:center; line-height: 14px; ; -webkit-text-size-adjust:none;" st-title="fulltext-btn"> <a style="text-decoration: none;color: #282828; text-align:center;" href="http://www.kiosagro.com/beli/?utm_source=notification&utm_medium=email&utm_term=email&utm_campaign=blast">Klik disini</a> </td></tr><tr> <td height="9" align="center" style="font-size:1px; line-height:1px;">&nbsp;</td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody></table><table width="100%" bgcolor="#f8f8f8" cellpadding="0" cellspacing="0" border="0" id="backgroundTable" st-sortable="seperator"> <tbody> <tr> <td> <table width="600" align="center" cellspacing="0" cellpadding="0" border="0" class="devicewidth"> <tbody> <tr> <td align="center" height="30" style="font-size:1px; line-height:1px;">&nbsp;</td></tr></tbody> </table> </td></tr></tbody></table> <table width="100%" bgcolor="#f8f8f8" cellpadding="0" cellspacing="0" border="0" id="backgroundTable" st-sortable="right-image"> <tbody> <tr> <td> <table width="600" cellpadding="0" cellspacing="0" border="0" align="center" class="devicewidth" bgcolor="#ffffff" align="center" width="600" style="border :2px solid #eaeff2"> <tbody> <tr> <td width="100%"> <table width="600" cellpadding="0" cellspacing="0" border="0" align="center" class="devicewidth"> <tbody> <tr> <td> <table width="280" align="right" border="0" cellpadding="0" cellspacing="0" class="devicewidth"> <tbody> <tr> <td width="280" height="140" align="center" class="devicewidth"> <img src="http://kiosagro.com/oc-content/themes/osclasswizards/images/promosi-kerjasama.jpg" alt="" border="0" width="280" height="140" style="display:block; border:none; outline:none; text-decoration:none;" class="col2img"> </td></tr></tbody> </table> <table align="left" border="0" cellpadding="0" cellspacing="0" class="mobilespacing"> <tbody> <tr> <td width="100%" height="15" style="font-size:1px; line-height:1px; mso-line-height-rule: exactly;">&nbsp;</td></tr></tbody> </table> <table width="280" align="left" border="0" cellpadding="0" cellspacing="0" class="devicewidth"> <tbody> <tr> <td> <table width="280" align="center" border="0" cellpadding="0" cellspacing="0" class="devicewidth"> <tbody> <tr> <td style="font-family: Helvetica, arial, sans-serif; font-size: 18px; color: #282828; text-align:left; line-height: 24px;"> Post Kerja Sama bidang Agribisnis </td></tr><tr> <td width="100%" height="15" style="font-size:1px; line-height:1px; mso-line-height-rule: exactly;">&nbsp;</td></tr><tr> <td style="font-family: Helvetica, arial, sans-serif; font-size: 14px; color: #4d4d4d; text-align:left; line-height: 24px;"> Post kerja sama bidang agribisnis anda disini dan temukan partner untuk berkembang bersama memajukan bisnis anda. </td></tr><tr> <td width="100%" height="15" style="font-size:1px; line-height:1px; mso-line-height-rule: exactly;">&nbsp;</td></tr><tr> <td> <table width="120" height="32" bgcolor="#1dff22" align="left" valign="middle" border="0" cellpadding="0" cellspacing="0" style="border-radius:3px;" st-button="learnmore"> <tbody> <tr> <td height="9" align="center" style="font-size:1px; line-height:1px;">&nbsp;</td></tr><tr> <td height="14" align="center" valign="middle" style="font-family: Helvetica, Arial, sans-serif; font-size: 13px; font-weight:bold;color: #ffffff; text-align:center; line-height: 14px; ; -webkit-text-size-adjust:none;" st-title="fulltext-btn"> <a style="text-decoration: none;color: #282828; text-align:center;" href="http://www.kiosagro.com/kerja-sama/?utm_source=notification&utm_medium=email&utm_term=email&utm_campaign=blast">Klik disini</a> </td></tr><tr> <td height="9" align="center" style="font-size:1px; line-height:1px;">&nbsp;</td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody></table><table width="100%" bgcolor="#f8f8f8" cellpadding="0" cellspacing="0" border="0" id="backgroundTable" st-sortable="seperator"> <tbody> <tr> <td> <table width="600" align="center" cellspacing="0" cellpadding="0" border="0" class="devicewidth"> <tbody> <tr> <td align="center" height="30" style="font-size:1px; line-height:1px;">&nbsp;</td></tr></tbody> </table> </td></tr></tbody></table><table width="100%" bgcolor="#f8f8f8" cellpadding="0" cellspacing="0" border="0" id="backgroundTable" st-sortable="footer"> <tbody> <tr> <td> <table width="600" bgcolor="#ffffff" cellpadding="0" cellspacing="0" border="0" align="center" class="devicewidth" style="border :2px solid #eaeff2"> <tbody> <tr> <td width="100%"> <table bgcolor="#ffffff" width="600" cellpadding="0" cellspacing="0" border="0" align="center" class="devicewidth"> <tbody> <tr> <td height="10" style="font-size:1px; line-height:1px; mso-line-height-rule: exactly;">&nbsp;</td></tr><tr> <td> <table width="150" align="center" border="0" cellpadding="0" cellspacing="0" class="devicewidth"> <tbody> <tr><td width="43" height="43" align="center"> <span style="font-size:14px; color:#a6a6a6">&copy; <a href="http://www.kiosagro.com/?utm_source=newsletter&utm_medium=email&utm_term=email&utm_campaign=websitename">kiosagro.com 2016</a></span></td></tr></tbody> </table> </td></tr><tr> <td height="10" style="font-size:1px; line-height:1px; mso-line-height-rule: exactly;">&nbsp;</td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody></table><table width="100%" bgcolor="#f8f8f8" cellpadding="0" cellspacing="0" border="0" id="backgroundTable" st-sortable="postfooter" > <tbody> <tr> <td> <table width="600" cellpadding="0" cellspacing="0" border="0" align="center" class="devicewidth"> <tbody> <tr> <td width="100%" height="20"></td></tr></tbody> </table> </td></tr></tbody></table> ' // html body
    };

    // send mail with defined transport object
    transporter.sendMail(mailOptions, function(error, info){
        if(error){
            //callback();
            callbackFailed(error);
            //console.log("Error Send Email");
            //console.log(error);
            return error;
        }
        console.log('Message sent: ' + info.response);
        callbackDone(job);
    });    
}

module.exports = new SendMail();